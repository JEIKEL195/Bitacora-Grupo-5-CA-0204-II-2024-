# Bitácora 2

## Parte de Planificación 

### Ordenamiento de la Literatura 

## Enlaces de la Literatura

## Análisis Estadístico

Como base para realizar este análisis estadístico, nos estamos guíando con la guía del curso de Herramientas de Ciencias de Datos, el cual adjuntamos el link a dicha guía https://maikolsolis.com/libros/hpcd/ y también estamos utilizando el libro escrito por Wickham, el cual también adjuntamos el link https://r4ds.hadley.nz/. 

A modo de introducción, el análisis estadístico consiste en un conjunto de herramientas o técnias que se utilizan para la recolección, el análisis e interpretación de datos. Para este trabajo es imprescindible contar con este set de herramientas. 

### Análisis Descriptivo 
La base de datos ya se encuentra en formato en tidy, recordemos que el formato tidy fue popularizado por el autor Hadley Wickham, donde indican que cada variable debe tener su propia columna y cada observación su propia fila. Nuestra base de datos cumple con estar en formato tidy. 


Vamos a llamar a nuestra base de datos, la cual vamos a utilizar durante el trabajo.

```{r}
library(readr)
base_financial_risk_assessment <- read_delim("base-financial-risk-assessment.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(base_financial_risk_assessment)
```

```{r}
head(base_financial_risk_assessment)
```

Antes de aplicar cualquier gráfico o análisis de datos a nuestra base de datos, es importante eliminar las variables que no aportan al estudio, por ello, vamos a eliminar los valores NA que vengan en nuestra base de datos.

```{r}
Base_limpia <- na.omit(base_financial_risk_assessment)
head(Base_limpia)
```

Con la base de datos limpia, ya podemos hacer un análisis estadístico, para ello vamos a calcular estadísticos base, como lo son la media, la varianza, el mínimo, el máximo de las variable numéricas, además de calcular la moda, para las variables que no sean numéricas. 

```{r, echo= FALSE}
library(dplyr)
resultado <- Base_limpia %>% 
  summarise(
    
    # calculamos los estadísticos de interés para la variable edad/Age
    media_edad = mean(Age),
    varianza_edad = var(Age),
    min_edad = min(Age),
    max_edad = max(Age),
    
    # Calculamos los estadísticos de interés para la variable ingreso/Income
    media_ingresos = mean(Income),
    varianza_ingresos = var(Income),
    min_ingresos = min(Income),
    max_ingresos = max(Income),
    
    # Calculamos los estadísticos de interés para la variable record_crediticio/ Credit Score
    media_record_crediticio = mean(`Credit Score`),
    varianza_record_crediticio = var(`Credit Score`),
    min_record_crediticio = min(`Credit Score`),
    max_record_crediticio = max(`Credit Score`),
    
    # Calculamos los estadísticos de interés para la variable monto del préstamo/ Loan Amount
    media_monto_prestamo = mean(`Loan Amount`),
    varianza_monto_prestamo = var(`Loan Amount`),
    min_monto_prestamo = min(`Loan Amount`),
    max_monto_prestamo = max(`Loan Amount`),
    
    # Calculamos los estadísticos de interés para variable anyos_trabajo / Years at current job
    media_anyos_trabajo = mean(`Years at Current Job`),
    varianza_anyos_trabajo = var(`Years at Current Job`),
    min_anyos_trabajo = min(`Years at Current Job`),
    max_anyos_trabajo = max(`Years at Current Job`),
  )
```

Estos son los datos resumidos de la variable edad.

```{r}
resultado$media_edad
resultado$min_edad
resultado$max_edad
```

Estos son los datos resumidos de la variable Ingresos 

```{r}
resultado$media_ingresos
resultado$varianza_ingresos
resultado$min_ingresos
resultado$max_ingresos
```

Estos son los datos resumidos de la variable Monto del Préstamo

```{r}
resultado$media_monto_prestamo
resultado$varianza_monto_prestamo
resultado$min_monto_prestamo
resultado$max_monto_prestamo
```


Ahora vamos analizar cómo es la distribución que siguen los géneros de nuestra base de datos, esto es solamente por sondear cómo es nuestra población. Al ser una variable categórica, lo recomendado es realizar un gráfico de barras.

```{r}
library(ggplot2)
# Gráfico con las distribuciones del género
ggplot(Base_limpia, aes(x = Gender, fill = Gender)) +
  geom_bar() +
  scale_fill_manual(values = c("Male" = "blue", "Female" = "pink", "Non-binary" = "gray")) +
  labs(x = "Distribución de Géneros", y = "Frecuencia") + theme_minimal()

```

Por otro lado, la variable "Income", es una variable continua, por lo que lo recomendado para visualizar la distribución de estos datos de una manera rápida es a través de los histogramas, por lo que adjuntamos el gráfico correspondiente:

```{r}
library(ggplot2)
ggplot(Base_limpia, aes(x = Income)) + 
  geom_histogram(binwidth = 10000, fill = "lightblue", color = "black") + 
  labs(x = "Ingreso", y = "Frecuencia", title = "Distribución de Ingresos") +
 theme_minimal()
```

Además decidimos realizar un facet en esta misma variable con respecto a la variable "Education Level", con el fin de visualizar la distribución en cada categoría, esto porque queremos descartar o validar que de alguna forma el nivel educativo tiene relación con nuestra variable objetivo, la cual es la calificación de riesgo.


```{r}
library(ggplot2)
ggplot(Base_limpia, aes(x = Income)) + 
  geom_histogram(binwidth = 10000, fill = "lightblue", color = "black") + 
  labs(x = "Ingreso", y = "Frecuencia", title = "Distribución de Ingresos") + theme_minimal() +
  facet_wrap(~ `Education Level`)  # Facet por nivel educativo
```

Adjuntamos un gráfico más de los ingresos, pero esta vez por género, con la misma curiosidad de observar cómo es la distribución de estos dada la mencionada variable.


```{r}
library(ggplot2)
ggplot(Base_limpia, aes(x = Income)) + 
  geom_histogram(binwidth = 10000, fill = "lightblue", color = "black") + 
  labs(x = "Ingreso", y = "Frecuencia", title = "Distribución de Ingresos") + theme_minimal() +
  facet_wrap(~ Gender)  # Facet Género
```


Otras variables a tener en cuenta aparte de las anteriores mencionadas con respecto al riesgo de crédito, son el monto del préstamos y el propósito del préstamo. Vamos analizar primero el Monto del préstamo, nos interesa ver qué distribución en general tiene.

```{r}
library(ggplot2)

ggplot(Base_limpia, aes(x = `Loan Amount`, fill = Gender)) +  
  geom_histogram(binwidth = 5000, color = "black", position = "identity") +  
  scale_fill_manual(values = c("Male" = "darkblue", "Female" = "purple", "Non-binary" = "green")) +  
  facet_wrap(~ Gender) +  
  labs(x = "Monto del Préstamo", y = "Frecuencia", title = "Distribución del Monto de Préstamo por Género") + 
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), # Ajustamos el tamaño del texto
        axis.text.x = element_text(angle = 45, hjust = 1))  #Rotamos el texto


```

Haremos lo mismo, pero esta vez vamos a ver cómo se comportan los salarios cuando cambiamos la variable y utilizamos por ejemplo el grado académico.

```{r}
library(ggplot2)

ggplot(Base_limpia, aes(x = `Loan Amount`, fill = `Education Level`)) +  
  geom_histogram(binwidth = 5000, color = "black", position = "identity") +  
  scale_fill_manual(values = c("Bachelor's" = "darkblue", "High School" = "purple", "Master's" = "green", "PhD" = "red")) +  
  facet_wrap(~ `Education Level`) +  
  labs(x = "Monto del Préstamo", y = "Frecuencia", title = "Distribución del Monto de Préstamo por Nivel Educativo") + 
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), # Ajustamos el tamaño del texto
        axis.text.x = element_text(angle = 45, hjust = 1))  #Rotamos el texto
```
Por otro lado, ahora queremos ver el gráfico de la variable propósito del préstamo en relación con el grado académico, al ser ambas variables categóricas, lo recomendado es utilizar una geometría que se adapte a esto, Sin embargo, al ser medidas que están muy cercanas, casi no se aprecia la diferencia, por lo que se decide adaptarlo a un gráfico de barras y apreciar mejor la diferencias de manera visual, también recurrimos al uso de colores, para identificar las variables. 

```{r}
library(ggplot2)
library(dplyr)

# Contar las combinaciones de Education Level y Loan Purpose
Base_count <- Base_limpia %>%
  group_by(`Education Level`, `Loan Purpose`) %>%
  summarise(Count = n(), .groups = 'drop')

# Gráfico de barras para visualizar el conteo
ggplot(Base_count, aes(x = `Education Level`, y = Count, fill = `Loan Purpose`)) +
  geom_bar(stat = "identity", position = "dodge") +  # Usa barras para mostrar el conteo
  labs(x = "Nivel Educativo", y = "Conteo", title = "Conteo del Propósito del Préstamo por Nivel Educativo") +
  scale_fill_manual(values = c("Business" = "blue", "Personal" = "purple", "Home" = "green", "Auto" = "yellow")) +
  theme_minimal()

```

Para terminar esta sección, vamos a graficar con la variable objetivo de interés, la cual es la Calificación de riesgo, para ello, lo vamos a comparar a través de diversos gráficos con las variables de nivel educativo, ingresos, monto del préstamo, edad y género. Es importante mencionar, que las variables en conjunto afectan a esta calificación, al menos así es de manera teórica. En este apartado nos vamos a centrar en estos gráficos, en secciones posteriores nos ecargaremos de hacer la conexión entre la teoría, nuestras hipótesis y los datos obtenidos. 

Para comenzar, nos interesa observar cómo se comporta la variable de Calificación de Riesgo, con respecto a la edad:

```{r}
library(ggplot2)
ggplot(Base_limpia, aes(x = Age, fill = `Risk Rating`)) +
  geom_bar() +  
  labs(x = "Edad", y = "Conteo", title = "Distribución de Calificación de Riesgo por Edad") + 
  theme_minimal() +  
  scale_fill_brewer(palette = "Set1")  
```


Por otro lado, vamos a ver cómo se comporta la distribución de la calificación de riesgo, haciendo un facet con la categoría Nivel Educativo. Al ser dos variables categóricas las que estamos comparando, lo recomendado es utilizar un gráfico de barras. 


```{r}
library(ggplot2)

ggplot(Base_limpia, aes(x = `Risk Rating`, fill = `Education Level`)) +  
  geom_bar(color = "black", position = "identity") +  
  scale_fill_manual(values = c("Bachelor's" = "darkblue", "High School" = "purple", "Master's" = "green", "PhD" = "red")) +  
  facet_wrap(~ `Education Level`) +  
  labs(x = "Calificación de Riesgo", y = "Frecuencia", title = "Distribución de la Calificación de Riesgo por Nivel Educativo") + 
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), # Ajustamos el tamaño del texto
        axis.text.x = element_text(angle = 45, hjust = 1))  # Rotamos el texto


```


A su vez, nos interesa observar cómo se ve el gráifco de la variable calificación de riesgo con la variable contra la variable ingreso. Para este gráfico, vamos a utilizar el recomendado en las notas del profesor Maikol Solís, el cual indica que usar diagramas de cajas es útil para comparar las distribuciones. 

```{r}
library(ggplot2)

ggplot(Base_limpia, aes(x = `Risk Rating`, y = Income, fill = `Risk Rating`)) +  
  geom_boxplot(color = "black") +  
  scale_fill_manual(values = c("Low" = "green", "Medium" = "yellow", "High" = "red", "Very High" = "purple")) +  
  labs(x = "Calificación de Riesgo", y = "Ingreso", title = "Comparación de la Calificación de Riesgo con el Ingreso") + 
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), # Ajustamos el tamaño del texto
        axis.text.x = element_text(angle = 45, hjust = 1))  # Rotamos el texto

```

Otra de las variables de interés, es la calificación de riesgo contra el propósito del préstamo. 

```{r}
library(ggplot2)

ggplot(Base_limpia, aes(x = `Loan Purpose`, fill = `Risk Rating`)) +  
  geom_bar(position = "fill", color = "black") +  
  scale_fill_manual(values = c("Low" = "green", "Medium" = "yellow", "High" = "red", "Very High" = "purple")) +  
  labs(x = "Propósito del Préstamo", y = "Proporción", title = "Distribución de la Calificación de Riesgo según el Propósito del Préstamo") + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotamos el texto para mejorar la legibilidad

```




